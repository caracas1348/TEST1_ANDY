<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="description" content="">
	<title>Prueba Tabla</title>
	<link rel="stylesheet" type="text/css" href="../../../../modules/bootstrap-4.4.1/dist/css/bootstrap-grid.min.css">
	<link rel="stylesheet" type="text/css" href="../../../../css/visitasa.css">
	<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@mdi/font@5.4.55/css/materialdesignicons.min.css">
	<!-- Custom styles !-->
	<style type="text/css">
		*{
			box-sizing: border-box;
		}
		html, body{
			height: auto;
		}
		body{
			min-height: 100vh;
		}
		h1,h2,h3{
			color: #254373;
		}
		.flex{
			display: flex;
		}
		.mb-6{
			margin-bottom: 6em;
		}
		.main{
			padding-top: 5em;
		}
		.justify-space-between{
			justify-content: space-between;
		}
		.navbar{
			height: 60px;
			background: #254373;
			color: white;
			display: flex;
			justify-content: space-around;
			align-items: center;
		}
		.navbar-link a{
			display: flex;
			align-items: center;
			color: #fff;
			text-decoration: none;
			font-weight: 600;
		}
		.navbar-link i{
			font-size: 18px;
			margin-right: 5px;
		}
		.navbar-link a:hover{
			color: #fff;
		}
		.btn{
			padding: 12px;
    	border-radius: 7px;
    	border:0;
		}
		.btn--lg{
			padding: 1.2em 1em;
		}
		.btn--primary{
			color: #fff;
    	background: #8ebb02;
    	font-weight: 600;
		}
		.btn--secondary{
			color: #fff;
    	background: #0072a0;
    	font-weight: 600;
		}
		.input-group label{
			display: block;
		}
		.input-group input, select{
			padding: 6px 12px!important;
			border: none;
			min-height: 38px;
			width: 100%;
			background-color: #fff;
			border-bottom: 1px solid!important;
		}
		.input-group-icon{
			display: flex;
		}
		.input-group-icon span{
			display: flex;
			min-height: 38px;
			border-bottom: 1px solid;
		}
		.input-group-icon span i{
			font-size: 18px;
		}
		.records{
			display: flex;
			align-items: center;
		}
		.records i{
			color: #b9d8e8;
			margin-right: 5px;
		}
		.table{
			width: 100%;
			border-collapse: collapse;
		}
		.table thead th{
			padding: 14px 6px;
			background: #254373;
			color: #fff;
		}
		.table thead th:first-child{
			border-top-left-radius: 10px;
			border-bottom-left-radius: 10px;
		}
		.table thead th:last-child{
			border-top-right-radius: 10px;
			border-bottom-right-radius: 10px;
		}
		tr.spacer td{
		 padding: 6px!important;
		 border: 0!important;
		}
		.table tbody tr td{
			padding: 16px 6px;
			border-top: 1px solid #ccc;
			border-bottom: 1px solid #ccc;
		}
		.table tbody tr td:first-child{
			padding-left: 12px;
			border-left-style: solid;
			border-left-color: #ccc;
			border-left-width: 1px;
			border-top-left-radius: 10px; 
    	border-bottom-left-radius: 10px;
		}
		.table tbody td:last-child{
			padding-right: 12px;
			border-right-style: solid;
			border-right-color: #ccc;
			border-right-width: 1px;
			border-top-right-radius: 10px; 
    	border-bottom-right-radius: 10px;
		}
	</style>
</head>
<body>
	<nav class="navbar">
		<div class="container">
			<div class="navbar-link">
				<a href="">
					<i class="mdi mdi-arrow-left"></i>
					<span>Historia Clínica Electrónica</span>
				</a>
			</div>
			<div class="navba-logo"></div>
			<div class="navbar-profile">
				
			</div>
		</div>
	</nav>
	<div class="container main">
		<div class="row mb-3">
			<div class="col-sm-12">	
				<h3>Búsqueda de registros</h3>
			</div>
		</div>
		<div class="row mb-6">
			<div class="col-sm-2">	
				<div class="input-group">
					<label for="gerencia">Gerencia</label>
					<select name="gerencia">
					  <option value="0"></option>
					</select>
				</div>
			</div>
			<div class="col-sm-2">	
				<div class="input-group">
					<label for="sede">Sede</label>
					<select name="sede">
					  <option value="0"></option>
					</select>
				</div>
			</div>
			<div class="col-sm-2">	
				<div class="input-group">
					<label for="area">Área</label>
					<select name="area">
					  <option value="0"></option>
					</select>
				</div>
			</div>
			<div class="col-sm-2">	
				<div class="input-group">
					<label for="fechaIni">Fecha desde</label>
					<input type="date" name="fechaIni">
				</div>
			</div>
			<div class="col-sm-2">	
				<div class="input-group">
					<label for="fechaFin">Fecha hasta</label>
					<input type="date" name="fechaFin">
				</div>
			</div>
			<div class="col-sm-2">	
				<button type="button" class="btn btn--primary btn--lg" id="search">Buscar</button>
			</div>
		</div>
		<!--<div class="row mb-6">
			</div>
			<div class="col-sm-2">	
				<div class="input-group">
					<label for="fechaHasta">F. Registro hasta</label>
					<input type="date" name="fechaHasta">
				</div>
			</div>
			<div class="col-sm-4">	
				<div class="input-group">
					<label for="search">Buscar</label>
					<div class="input-group-icon">
						<input type="text" name="search">
						<span><i class="mdi mdi-magnify"></i></span>
					</div>
				</div>
			</div>
		</div>!-->
		<div class="row mb-3">
			<div class="col-sm-12">
				<div class="flex justify-space-between">
					<div class="records">
					</div>
					<div>
						<button type="button" class="btn btn--primary btn--lg" style="width: 160px;">Nueva Atencíon</button>
						<button type="button" class="btn btn--secondary btn--lg"><i class="mdi mdi-chevron-down mdi"></i></button>
					</div>
				</div>
			</div>
		</div>
		<div class="row mb-5">
			<div class="col-sm-12">
				<table class="table">
					<thead>
						<th>Código</th>
						<th>Tipo de evento</th>
						<th>Empresa</th>
						<th>Sede</th>
						<th>Zona</th>
						<th>Estado</th>
						<th>Nombre de Personal</th>
						<th>Fecha</th>
					</thead>
					<tbody>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</body>
	<script src="../../../../js/jquery-3.4.1.js" ></script>
	<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
	<script type="text/javascript">
		let url = 'https://550m44ud1tmg7454-inspection-dev.azurewebsites.net/api/Get-Incidente-AccidenteWeb?code=GY7/yooa3Zl5sKu7zgakDbaCn4uvOKXjfwe/JkbSuIwDPOs/baiZFQ==&httpmethod=objectlist&IdTipoEvento=0&IdEmpresa=0&IdSede=0&FechaInicio=&FechaFin=&IdEmbarcacion=0'

		renderItems = (items) => {
			$('.table tbody').html('')
			if(items.length){
				items.map(item => {
					$('.table tbody').append(`
						<tr class="spacer">
							<td colspan="8"></td>
						</tr>
						<tr>
							<td>${item.Code}</td>
							<td>${item.Tipo_Evento}</td>
							<td>${item.NombreEmpresa}</td>
							<td>${item.Sede}</td>
							<td>${item.Zona}</td>
							<td>${item.Estado_Incidente}</td>
							<td>${item.A_NombrePersonalAccidentado}</td>
							<td>${item.Fecha}</td>
						</tr>
					`)
				})
			}else{
				$('.table tbody').append(`
					<tr class="spacer">
						<td colspan="8"></td>
					</tr>
					<tr>
						<td colspan="8">No se encontraron resultados para la búsqueda</td>
					</tr>
				`)
			}

			$('.records').html('')
			$('.records').append(`
				<i class="mdi mdi-file-document-multiple mdi-24px"></i>
        <span><strong>${items.length}</strong> registro(s)</span>
      `)
		}

		$(document).ready(()=>{
			axios.get(url,{
				headers: {
			   apiKey:'r$3#23516ewew5'
			 	}
			}).then( res => {
				
				if(res.data.Gerencias){
					res.data.Gerencias.map(item => {
						$("select[name='gerencia']").append(`
							<option value="${item.Id}">${item.Empresa}</option>
						`)
					})
				}

				if(res.data.Areas){
					res.data.Areas.map(item => {
						$("select[name='area']").append(`
							<option value="${item.Id}">${item.Area}</option>
						`)
					})
				}


				if(res.data.Sedes){
					res.data.Sedes.map(item => {
						$("select[name='sede']").append(`
							<option value="${item.Id}">${item.Sede}</option>
						`)
					})
				}

				if(res.data.PlanAnual){
					renderItems(res.data.PlanAnual)
				}

			}).catch(err => {
				console.log(err)
			})

			$('#search').click(e => {
				e.preventDefault()
				let data = {
					idEmpresa:parseInt($("select[name='gerencia'").val()),
					idSede:parseInt($("select[name='sede'").val()),
					idArea:parseInt($("select[name='area'").val()),
					fechaInicio:$("input[name='fechaIni']").val(),
					fechaFin:$("input[name='fechaFin']").val(),
				}

				const url2 = 'https://550m44ud1tmg7454-inspection-dev.azurewebsites.net/api/Get-Incidente-AccidenteWeb?code=GY7/yooa3Zl5sKu7zgakDbaCn4uvOKXjfwe/JkbSuIwDPOs/baiZFQ==&httpmethod=objectlist'
				axios.get(url2,{
					headers: {
			   		apiKey:'r$3#23516ewew5'
			 		},
					params: data
				}).then(res=>{
						console.log(res.data)
						if(res.data.PlanAnual){
							renderItems(res.data.PlanAnual)
						}
				}).catch(err=>{
					console.log(err)
				})
			})
		})
	</script>
</html>